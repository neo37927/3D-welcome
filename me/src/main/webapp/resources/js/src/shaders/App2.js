var App=function(){var a,b,c,d,e,f="petals",g=!1,h=(document.getElementById("music"),{size:512,simMat:createShaderMaterial(SimShader),drawMat:createShaderMaterial(ParticleShader),update:void 0}),i=["SIM_PLANE","SIM_CUBE","SIM_DISC","SIM_SPHERE","SIM_BALL","SIM_ROSE_GALAXY","SIM_GALAXY","SIM_NOISE","SIM_TEXTURE"],j={},k={none:{"user gravity":3,"shape gravity":1,_shape:""},plane:{"user gravity":4,"shape gravity":3,_shape:"SIM_PLANE"},sphere:{"user gravity":4,"shape gravity":3,_shape:"SIM_SPHERE"},galaxy:{"user gravity":3,"shape gravity":1,_shape:"SIM_GALAXY"},petals:{"user gravity":3,"shape gravity":2,_shape:"SIM_ROSE_GALAXY"}},l=function(a){a!==d&&(d=a,i.forEach(function(a){delete h.simMat.defines[a]}),a&&(h.simMat.defines[a]=""),h.simMat.needsUpdate=!0)},m=function(a){var c=k[a]||k.none;f=a,c._shape.length>=0?(l(c._shape),e.setMesh()):(l("SIM_TEXTURE"),e.setMesh(c._shape.mesh)),b["user gravity"]=h.simMat.uniforms.uInputAccel.value=c["user gravity"],b["shape gravity"]=h.simMat.uniforms.uShapeAccel.value=c["shape gravity"]},n=function(){c.renderer.getImageData(function(a){var b=Utils.dataUrlToBlobUrl(a);Utils.openUrlInNewWindow(b,window.innerWidth,window.innerHeight)})},o=(h.update=function(a,b){h.drawMat.uniforms.uTime.value=b,e.update(a,b),g&&o(a,b)},function(){var a,c=25,d=15,e="galaxy",g=["wolf","petals","bear","sphere","horse","panther","plane","bison"],h=0,i=0;return function(j,k){0>=h&&(f===a?(m(e),b.shape=e,h=d):(i>=g.length&&(i=0,Utils.shuffle(g),console.log("tour shuffled: "+g)),a=g[i++],m(a),b.shape=a,console.log("tour: "+a),h=c)),h-=j}}()),p=function(){c=new ParticleEngine(h),e=new UVMapAnimator(c.renderer.getRenderer(),h.size),h.simMat.uniforms.tTarget={type:"t",value:e.target}},q=function(){a=new dat.GUI,b={color1:[255*h.drawMat.uniforms.uColor1.value.x,255*h.drawMat.uniforms.uColor1.value.y,255*h.drawMat.uniforms.uColor1.value.z],color2:[255*h.drawMat.uniforms.uColor2.value.x,255*h.drawMat.uniforms.uColor2.value.y,255*h.drawMat.uniforms.uColor2.value.z],alpha:h.drawMat.uniforms.uAlpha.value,"color speed":h.drawMat.uniforms.uColorSpeed.value,"color freq":h.drawMat.uniforms.uColorFreq.value,"point size":h.drawMat.uniforms.uPointSize.value,"user gravity":h.simMat.uniforms.uInputAccel.value,"shape gravity":h.simMat.uniforms.uShapeAccel.value,shape:f,paused:!1,"camera rotate":!0,"camera control":!1,screenshot:n,fullscreen:Utils.toggleFullscreen,"take tour!":g,music:!0}},r=function(){Mousetrap.bind("space",function(){return b.paused=!b.paused,c.pauseSimulation(b.paused),!1}),Mousetrap.bind(["alt","option"],function(){return b["camera control"]=!0,c.enableCameraControl(!0),!1},"keydown"),Mousetrap.bind(["alt","option"],function(){return b["camera control"]=!1,c.enableCameraControl(!1),!1},"keyup")},s=function(){var a=new THREE.JSONLoader(!0);Object.keys(j).forEach(function(b){a.load(j[b].url,function(a){var c=new THREE.MorphAnimMesh(a);c.scale.set(j[b].scale,j[b].scale,j[b].scale),c.position.y=j[b].yOffset,c.duration=1e3/j[b].speed,c.name=b,j[b].mesh=c,f===b&&e.setMesh(c)})})};s(),p(),q(),r(),m(f),c.start();var t=[76,65,255];h.drawMat.uniforms.uColor1.value.x=t[0]/255,h.drawMat.uniforms.uColor1.value.y=t[1]/255,h.drawMat.uniforms.uColor1.value.z=t[2]/255,t=[160,82,247],h.drawMat.uniforms.uColor2.value.x=t[0]/255,h.drawMat.uniforms.uColor2.value.y=t[1]/255,h.drawMat.uniforms.uColor2.value.z=t[2]/255,h.drawMat.uniforms.uAlpha.value=.25,h.drawMat.uniforms.uColorSpeed.value=5,h.drawMat.uniforms.uColorFreq.value=3,h.drawMat.uniforms.uPointSize.value=2.5,h.simMat.uniforms.uInputAccel.value=3,h.simMat.uniforms.uShapeAccel.value=2};